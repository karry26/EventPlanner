define(["require","exports","tslib","react","external/react-redux","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/file_viewer/share_helpers","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/react/size_class/constants","modules/core/i18n","modules/core/browser_detection","modules/clean/react/paper/utils","modules/clean/react/paper/open_in_paper_button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/client","modules/clean/react/file_viewer/data/selectors","modules/clean/react/extensions/split_share_button","modules/clean/react/extensions/utils","modules/clean/integrations/zoom_share_dialog/async_modal","modules/clean/react/extensions/data/types","modules/clean/sharing/constants"],function(e,t,n,a,i,o,r,l,s,u,c,p,d,h,f,m,_,S,I,k,v,w,C,B,y,P,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),u=n.__importStar(u);var E=(function(t){function i(){var a=null!==t&&t.apply(this,arguments)||this;return a.state={linkMetadata:null},a.cancelGetSharedLinkInfo=function(){},a.handleSplitShareButtonShareClick=function(){a.handleShareClick()},a.handleShareButtonClick=function(){return n.__awaiter(a,void 0,void 0,function(){var t,a,i;return n.__generator(this,function(o){switch(o.label){case 0:return this.handleShareClick(),[4,new Promise(function(t,n){e(["modules/clean/react/app_actions/telemetry_client"],t,n)}).then(n.__importStar)];case 1:return t=o.sent(),a=t.createTelemetryClient,i=t.getPiiSafeExtension,a({component:"share-btn"}).session({surface:"previews",ext:i(this.props.file.ext)}).event("click_share",{trigger_type:P.TriggerType.PrimaryButton}),[2]}})})},a.handleShareMenuItemClick=function(){a.handleShareClick()},a.handleShareClick=function(){u.share(a.props.file,a.props.user,null,g.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),o.logUserAction(r.UserAction.Share,r.UserActionContext.TitleBarMain)},a.handlePresentInZoom=function(){var e=a.props,t=e.user,n=e.file;y.asyncShowModal(t.id,n.file_id,"file-viewer-modal-overlay")},a.removeShareLink=function(){var e=new d.ShareApiClient({userId:a.props.user.id}),t=a.state.linkMetadata,n=t.name,i=t.url;h.deleteLinkWithConfirm({client:e,contentName:n,onCancel:null,onDeleteLink:function(){return a.setState({linkMetadata:null})},url:i})},a}return n.__extends(i,t),i.prototype.componentDidMount=function(){this.setupShare(this.props),this.setState({openInPaperButtonVariant:S.getOpenInPaperButtonVariant({file:this.props.file,user:this.props.user})})},i.prototype.componentWillUnmount=function(){this.cancelGetSharedLinkInfo()},i.prototype.componentWillReceiveProps=function(e){e.file!==this.props.file&&(this.cancelGetSharedLinkInfo(),this.setState({linkMetadata:null}),this.setupShare(e))},i.prototype.setupShare=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,a,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return t=!1,this.cancelGetSharedLinkInfo=function(){t=!0},a=new d.ShareApiClient({userId:e.user.id}),[4,a.sharedLinkInfo({fileIdOrPath:e.file.fq_path})];case 1:return i=n.sent(),o=i[0],t||this.setState({linkMetadata:o}),this.cancelGetSharedLinkInfo=function(){},[2]}})})},i.prototype.logUserActionInTitleBarFactory=function(e){return function(){return o.logUserAction(e,r.UserActionContext.TitleBarMain)}},i.prototype.render=function(){var e=!!this.state.linkMetadata&&this.state.linkMetadata.link_permissions.can_revoke,t=this.props,i=t.file,o=t.extensionsConfig,u=t.sizeClass,d=t.shouldDisplayActionButtons,h=t.user,w=u===f.SizeClass.Small,y={allowRemoveLink:e,isPrivate:!0,file:i,onClickShareLink:this.handleShareMenuItemClick,onRemoveShareLink:this.removeShareLink,sizeClass:u,user:h,showOpenInPaper:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Ellipsis&&!w,extensionsConfig:o};if(u!==f.SizeClass.Large){var P=null;return d&&!_.is_mobile_or_tablet()&&u!==f.SizeClass.Small&&(o.displayState===v.DisplayState.ENABLED?P=a.default.createElement("div",{className:"control__button"},a.default.createElement(k.ExtensionsMenu,{user:h,file:i,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:this.handlePresentInZoom})):o.displayState===v.DisplayState.DISABLED&&(P=a.default.createElement(s.OpenButton,{file:i,location:r.FileViewerPane.TitleBar,user:h}))),a.default.createElement(c.TitleBarControlsContainer,null,P,a.default.createElement(l.MoreDropdown,n.__assign({},y)))}var g;d&&(g=B.shouldShowSplitShare(o,i)?[a.default.createElement(C.SplitShareButton,{user:h,file:i,onShowShare:this.handleSplitShareButtonShareClick,context:{surface:"previews"},variant:"primary",showEduTooltip:!0,onPresentInZoom:this.handlePresentInZoom})]:[a.default.createElement("button",{className:"share-button button-primary control__button",onClick:this.handleShareButtonClick,key:0},m._("Share"))],this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Button&&g.push(a.default.createElement(I.OpenInPaperButton,{key:"openinpaper",file:i,user:h,hideCallout:!1})),o.displayState===v.DisplayState.ENABLED?g.push(a.default.createElement("div",{className:"control__button"},a.default.createElement(k.ExtensionsMenu,{user:h,file:i,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:function(){}}))):o.displayState===v.DisplayState.DISABLED&&g.push(a.default.createElement(s.OpenButton,{file:i,location:r.FileViewerPane.TitleBar,user:h,key:2,sizeClass:this.props.sizeClass,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===S.OpenInPaperButtonVariant.Dropdown})));var E=h.is_guest_admin?"":a.default.createElement(p.UserNotificationsDropdown,{isPagelet:!1,onClick:this.logUserActionInTitleBarFactory(r.UserAction.ClickNotifications)});return a.default.createElement(c.TitleBarControlsContainer,null,g,a.default.createElement(l.MoreDropdown,n.__assign({},y)),a.default.createElement("div",{className:"react-title-bar__divider"}),E)},i})(a.default.Component);t.UnconnectedMountedFileActions=E;var x=function(e){return{extensionsConfig:w.getExtensionsConfig(e)}};t.MountedFileActions=i.connect(x)(E)});
//# sourceMappingURL=mounted_file_actions.min.js-vfl3cXEja.map