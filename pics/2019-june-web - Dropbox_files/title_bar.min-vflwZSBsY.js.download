define(["require","exports","tslib","react","external/classnames","external/react-redux","modules/clean/previews/data/actions","modules/clean/previews/util","modules/core/browser","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/title_bar/base","modules/clean/react/title_bar/controls_container","modules/clean/react/file_viewer/title_name","file-viewer/core","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button","spectrum/popover","modules/clean/react/snackbar","modules/clean/browse_uri_interface","modules/clean/react/watermarking/constants"],function(e,t,a,r,l,i,n,o,s,c,p,u,d,m,_,f,h,v,C,w,k,y,g,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),l=a.__importDefault(l),o=a.__importStar(o),s=a.__importStar(s),t.ApplyWatermarkButton=function(e){return r.default.createElement(k.Popover,{onSelection:e.onApply},r.default.createElement(k.PopoverTrigger,null,r.default.createElement(w.Button,{tagName:"span",variant:"primary",onClick:e.onClick},C._("Apply Watermark",{project:A.WM_I18N_PROJECT})+"  ▾")),r.default.createElement(k.PopoverContent,null,r.default.createElement(k.PopoverContentItem,{value:!1,className:"apply-watermark-menu-item__copy"},C._("Save as copy",{project:"web",comment:"As in: save the watermarked file as a copy"})),r.default.createElement(k.PopoverContentItem,{value:!0,className:"apply-watermark-menu-item__overwrite"},C._("Overwrite this file",{project:"web",comment:"As in: overwrite this file with watermarked file"}))))};var M=(function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleApply=function(e){return a.__awaiter(t,void 0,void 0,function(){var t,l;return a.__generator(this,function(a){switch(a.label){case 0:y.Snackbar.sync(C._("Watermarking file...",{project:A.WM_I18N_PROJECT})),u.logUserAction(e?p.UserAction.WatermarkApplyOverwrite:p.UserAction.WatermarkApplySaveAsCopy,p.UserActionContext.TitleBarMain),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,v.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,e)];case 2:return t=a.sent(),e?(this.props.applyVirtualPreviewMetadata(this.props.file),y.Snackbar.update(r.default.createElement(y.Snackbar,{variant:"complete",title:C._("Watermark applied. To review, go to the file’s version history.",{project:A.WM_I18N_PROJECT}),actionButtonText:C._("Version history",{project:A.WM_I18N_PROJECT}),onActionClick:this.handleVersionHistoryClick,closeButtonText:C._("Close",{project:A.WM_I18N_PROJECT})}))):t.fq_path?s.replace_location(g.preview_uri_for_fq_path(this.props.user,t.fq_path)):y.Snackbar.update(r.default.createElement(y.Snackbar,{variant:"complete",title:C._("We saved a watermarked copy of this file.",{project:A.WM_I18N_PROJECT}),closeButtonText:C._("Close",{project:A.WM_I18N_PROJECT})})),this.props.clearVirtualPreviewMetadata(),this.props.changeMode(f.FileViewerMode.Default),[3,4];case 3:return l=a.sent(),y.Snackbar.fail(C._("Couldn’t apply the watermark to the file. Please reload the page and try again.",{project:A.WM_I18N_PROJECT})),[3,4];case 4:return[2]}})})},t.handleCancel=function(){u.logUserAction(p.UserAction.WatermarkCancel,p.UserActionContext.TitleBarSecondaryButton),t.props.changeMode(f.FileViewerMode.Default),t.props.clearVirtualPreviewMetadata()},t.handleClose=function(){u.logUserAction(p.UserAction.WatermarkCancel,p.UserActionContext.TitleBarBackButton),t.props.changeMode(f.FileViewerMode.Default),t.props.clearVirtualPreviewMetadata()},t.handleVersionHistoryClick=function(){if(!t.props.user)throw new Error("User not specified");o.redirectToVersionHistory(t.props.file,t.props.user),u.logUserAction(p.UserAction.ViewRevisions,p.UserActionContext.WatermarkOverwriteNotice)},t.logApplyButtonClick=function(){u.logUserAction(p.UserAction.WatermarkOpenApplyMenu,p.UserActionContext.TitleBarMain)},t}return a.__extends(i,e),i.prototype.render=function(){var e=this.props,a=e.className,i=e.file,n=e.fileSubpath,o=e.hidePageChrome,s=e.isViewingFileSubpath,c=e.maxFilenameEmLength,p=e.sharedLinkInfo,u=e.sizeClass,f=e.user;return r.default.createElement(d.TitleBarBase,{canClose:!0,className:l.default("react-title-bar--dark",a),closeTitle:C._("Back",{project:A.WM_I18N_PROJECT}),file:i,onClose:this.handleClose,shouldShowIcon:!s,sizeClass:u,title:r.default.createElement(_.TitleName,{file:i,fileSubpath:n,hidePageChrome:o,isViewingFileSubpath:s,maxFilenameEmLength:c,sharedLinkInfo:p,shouldDisplayStarred:!1,sizeClass:u,user:f}),controls:r.default.createElement(m.TitleBarControlsContainer,null,r.default.createElement("div",{className:"control__button"},r.default.createElement(t.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick})),r.default.createElement("div",{className:"control__button"},r.default.createElement(w.Button,{variant:"secondary",onClick:this.handleCancel},C._("Cancel",{project:A.WM_I18N_PROJECT}))))})},i})(r.default.Component);t._TitleBar=M;var P=i.connect(null,{changeMode:h.changeMode,clearVirtualPreviewMetadata:n.clearVirtualPreviewMetadata,setVirtualPreviewMetadata:n.setVirtualPreviewMetadata,applyVirtualPreviewMetadata:n.applyVirtualPreviewMetadata})(M),E=c.requireCssWithComponent(P,["/static/css/react_title_bar-vfl0jJnEK.css"]);t.TitleBar=E});
//# sourceMappingURL=title_bar.min.js-vfl73ms13.map