define(["require","exports","tslib","external/lodash","react","modules/clean/ajax","modules/clean/browse_interface","modules/clean/cloud_docs/constants","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/async_file_modal_controller","modules/clean/react/async_fileops_modals","modules/clean/react/async_overquota_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/client_download_modal","modules/clean/react/browse/constants","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/extensions/client","modules/clean/react/extensions/data/types","modules/clean/react/extensions/split_share_button_component","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/async_controller","modules/clean/react/fileops_actions","modules/clean/react/files_view/types","modules/clean/react/folder_dialog/api","modules/clean/react/folder_dialog/constants","modules/clean/react/folder_overview/data/action_creators","modules/clean/react/folder_overview/data/store","modules/clean/react/folder_overview/pin_to_modal","modules/clean/react/folder_overview/utils","modules/clean/react/retrieval_success_banner/util","modules/clean/react/starred/browse_exports","modules/clean/search/search_results/log_helper","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/views/exp_showcase_share_interstitial","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/clean/viewer","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,o,r,i,s,t,n,a,l,c,u,d,h,f,_,p,w,m,S,v,F,y,g,A,b,E,M,T,N,C,P,R,D,I,O,L,x,U,B,V,W,k,z,q,H,Q,G,Y,J,j){"use strict";function Z(e){return e.isDeleted||e.is_unmounted}function K(e){var o=e.toArray().map(function(e){return e.fq_path});return c.inSameDirectory(o)}function X(e){var o=e.result,r=e.files,i=e.user,s=e.action_type,t=e.isSearchMode,n=e.view_type,a=e.source,l=F.countFilesAndFolders(r),c=l.num_files_selected,u=l.num_folders_selected;t&&B.recordSearchResultsAction({result:o,user:i,action_type:s,view_type:n}),w.logBrowseAction(i.id,a,s,c,u,n,o)}function $(e){var o=e.context,i=e.files,s=e.user,t=e.viewType,n=e.fileExtensionsConfigs,a=e.canDisplayFolderSizes,l=void 0!==a&&a,c=e.isSearchMode,u=void 0!==c&&c,d=e.isQueryingFolderSizes,h=e.showAddToShowcase,f=void 0!==h&&h,_=e.showAddFolderToShowcase,p=void 0!==_&&_,w=e.hasShowcaseFreemium,m=void 0!==w&&w,S=e.isSidebar,v=e.showFolderCalcSize,F=void 0!==v&&v,y=e.expFolderHistoryRollbacks,g=void 0!==y&&y,A=e.pinnedItems,b=r.__assign({},te);if(o.isInsideArchivedTeamFolder)return b.showDownload=!0,b;var E=i.every(function(e){return!Z(e)}),M=!E&&i.every(function(e){return Z(e)});return E?ee({actions:b,canDisplayFolderSizes:l,expFolderHistoryRollbacks:g,context:o,files:i,fileExtensionsConfigs:n,isQueryingFolderSizes:d,isSearchMode:u,showAddToShowcase:f,showAddFolderToShowcase:p,hasShowcaseFreemium:m,isSidebar:S,showFolderCalcSize:F,user:s,viewType:t,pinnedItems:A}):M?oe({actions:b,files:i,context:o,user:s}):b}function ee(e){var o,r=e.actions,i=e.context,s=e.files,t=e.user,n=e.viewType,l=e.fileExtensionsConfigs,d=e.canDisplayFolderSizes,h=void 0!==d&&d,f=e.isQueryingFolderSizes,_=void 0!==f&&f,p=e.isSearchMode,w=void 0!==p&&p,m=e.showAddToShowcase,S=void 0!==m&&m,v=e.showAddFolderToShowcase,F=void 0!==v&&v,g=e.hasShowcaseFreemium,b=void 0!==g&&g,E=(e.isSidebar,e.showFolderCalcSize),T=void 0!==E&&E,N=e.expFolderHistoryRollbacks,P=void 0!==N&&N,R=e.pinnedItems,D=s.first(),I=1===s.count(),O=I&&!D.is_dir,L=I&&D.is_dir,x=s.every(function(e){return e.type===u.FileTypes.FILE}),B=s.some(function(e){return e.type===u.FileTypes.TEAM_SHARED_FOLDER}),W=s.some(function(e){return e.type===u.FileTypes.TEAM_MEMBER_FOLDER}),k=s.some(function(e){return e.type===u.FileTypes.SANDBOX}),Q=!1;if(B||W||(r.showCopy=!0,r.showDelete=!0,r.showMove=!0,r.showRename=I),B&&L&&t&&V.GoldenGate.hasContentManagerAndSuperAdmin(t.id)&&(r.showRenameTeamFolder=!0,r.showArchive=!0),!H.Viewer.get_viewer().is_assume_user_session&&t&&V.GoldenGate.hasContentManagerAndSuperAdmin(t.id)&&V.GoldenGate.hasNewOwnershipModel(t.id)&&i.isInsideTeamFolderTree&&(r.showManageAsAdmin=!0),I){var G=s.first();o=V.shouldUsePublicFolderSharing(i.config,G.fq_path),o||W||k||(r.showTiburonShare=!0),Q=q.UnityFeatures.isUnitySupported()&&null!=z.default&&z.default.is_cached_and_locally_available(G.ns_id,G.ns_path),Q&&(r.showOpen=!0),l&&l[G.file_id]&&l[G.file_id].displayState===A.DisplayState.ENABLED&&(r.showOpenWith=!0),l&&l[G.file_id]&&M.shouldShowSplitShare(l[G.file_id],G)&&(r.showSplitShare=!0)}if(L&&P&&(r.showRewindFolder=!0),r.showShowInFolder=w&&K(s),O&&(r.showComment=!D.is_cloud_doc,r.showVersions=!D.is_cloud_doc||!a.isPointerByExtension(D.ns_path),i.isInFolderMode?r.showCopyPublicFolderFileLink=!!o:r.showCopyPublicFolderFileLink=!1),Q||(O?D.is_cloud_doc?r.showDownload=!1:r.showDownload=!0:r.showDownload=i.isInFolderMode||w),(x||F&&L)&&i.isCurrentPathWriteable()&&S&&!b&&(r.showProfessionalCollectionShare=!0),I){var Y=s.first().type;Y!==u.FileTypes.SHARED_FOLDER&&Y!==u.FileTypes.TEAM_SHARED_FOLDER||(r.showSharedFolderEvents=!0),L&&null==s.first().fetchFolderSizesStatus&&!_&&!w&&n!==C.ViewType.Grid&&h&&(r.showCalculateFolderSize=!0)}if(T){var J=s.every(function(e){return null==e.fetchFolderSizesStatus}),j=s.every(function(e){return e.is_dir}),Z=s.some(function(e){return!y.File.canViewFileMembers(e,i)});J&&j&&!Z&&!_&&!w&&n!==C.ViewType.Grid&&h&&(r.showCalculateFolderSize=!0)}if(I){var X={id:s.first().file_id,type:U.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID},$=U.StarredStore.getIsLoading(X),ee=U.StarredStore.getIsStarred(X);r.showStar=ee===!1,r.showUnstar=ee===!0,r.showLoadingStar=$}if(void 0!==R&&i.isCurrentPathWriteable()&&!w){var oe=R.map(function(e){return e.file_id}),re=s.toArray().filter(function(e){return oe.includes(e.file_id)}).length;r.showUnpin=re===s.size,r.showPin=re<s.size,r.showPinTo=c.normalize(i.currentFQPath).split("/").length>1}return r}function oe(e){var o=e.actions,r=e.files,i=e.context,s=e.user,t=r.first();if(r.some(function(e){return e.is_unmounted||e.ns_id!==t.ns_id}))return o;1===r.count()&&t.is_dir&&i.inactiveNSIDByFQPath[t.fq_path.toLowerCase()]&&!i.isInsideTeamFolderTree?o.showReadd=!0:o.showRestore=!0;var n;if(i.isInFolderMode)n=i.permanentDeletionDisabledStateByNSID[i.currentNSID];else{n=r.map(function(e){return e.ns_id}).some(function(e){return i.permanentDeletionDisabledStateByNSID[e]})}return!H.Viewer.get_viewer().is_assume_user_session&&s&&V.GoldenGate.hasContentManagerAndSuperAdmin(s.id)&&V.GoldenGate.hasNewOwnershipModel(s.id)&&i.isInsideTeamFolderTree&&(o.showManageAsAdmin=!0),n||(o.showPermanentDelete=!0),o}function re(e,o){var r=o.user,i=o.context,s=o.firstFile,n=o.files,a=o.isSearchMode,l=o.source,u=o.viewType,d=o.useSearchSuccessBanner;if(X({result:s,files:n,user:r,action_type:Q.WebUserActionLogEvent.SHARE,view_type:u,isSearchMode:a,source:l}),Le(d,a),e.autoShareLink){var h=new j.URI({path:"/sm/create"+c.normalize(s.fq_path)});h.updateQuery("_subject_uid",r.id.toString()),h.updateQuery("redirect","0");var f=function(e){Y.redirect(e)};t.WebRequest({url:h.toString(),type:"POST",success:f})}else{var _=function(){V.asyncShowShareModal(r,s,{browseContext:i,origin:W.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},g.browseNavActions.setPath,g.browseNavActions.setUrl)};o.showShowcaseInterstitialExp?k.showShowcaseInterstitial({user:r,onClickShare:_,onClickShowcase:de(o,o.hasCreatedShowcase,o.hasShowcaseFreemium,!0)}):_()}}function ie(e){var o=e.files,r=e.context,i=e.user,t=e.responsive,n=e.fileExtensionsConfigs,a=e.canDisplayFolderSizes,u=void 0!==a&&a,d=e.actionHandlers,f=e.skipSharing,_=void 0!==f&&f,p=e.source,w=e.viewType,m=e.isOverFreeQuota,S=void 0!==m&&m,v=e.hasExcludedNsIds,F=void 0!==v&&v,g=e.isSearchMode,A=void 0!==g&&g,T=e.isQueryingFolderSizes,N=void 0!==T&&T,C=e.canShowUJPopup,P=void 0!==C&&C,R=e.showAddToShowcase,D=void 0!==R&&R,I=e.showAddFolderToShowcase,O=void 0!==I&&I,L=e.hasCreatedShowcase,x=void 0!==L&&L,U=e.hasShowcaseFreemium,B=void 0!==U&&U,V=e.isSidebar,W=void 0!==V&&V,k=e.showShowcaseInterstitialExp,z=void 0!==k&&k,q=e.showFolderSuggestion,H=void 0!==q&&q,Q=e.showFolderCalcSize,G=void 0!==Q&&Q,Y=e.createNewFolderInMoveDialog,j=void 0!==Y&&Y,Z=e.useSearchSuccessBanner,K=void 0!==Z&&Z,X=e.pinnedItems,ee=e.expFolderHistoryRollbacks,oe=void 0!==ee&&ee,re=o.first(),ie=!r.isCurrentPathWriteable()||o.some(function(e){return e.read_only}),se=ie,te=ie,ae=ie,Le=ie,xe=o.some(function(e){return!y.File.canViewFileMembers(e,r)}),Be=xe,Ve=xe,We=o.every(y.File.isNoAccessSharedFolder),ke=We,ze=We,qe=We,He=o.some(y.File.isNoAccessSharedFolder),Qe=!t.isMatchedMedium&&!t.isMatchedLarge,Ge=$({files:o,context:r,user:i,viewType:w,fileExtensionsConfigs:n,canDisplayFolderSizes:u,isQueryingFolderSizes:N,isSearchMode:A,showAddToShowcase:D,showAddFolderToShowcase:O,hasShowcaseFreemium:B,isSidebar:W,expFolderHistoryRollbacks:oe,showFolderCalcSize:G,pinnedItems:X}),Ye=new Array,Je={user:i,context:r,actionHandlers:d,files:o,firstFile:re,isSearchMode:A,source:p,viewType:w,hasCreatedShowcase:x,hasShowcaseFreemium:B,showShowcaseInterstitialExp:z,useSearchSuccessBanner:K,isSidebar:W};if(!_&&Ge.showTiburonShare){var je=Be;W&&!A&&!Qe&&Ge.showSplitShare&&n&&n[re.file_id]&&M.shouldShowSplitShare(n[re.file_id],re)?Ye.push(function(){return s.default.createElement(E.SplitShareButton,{file:re,user:i,variant:"primary",triggerType:b.TriggerType.SidebarPrimaryButton,onShowShare:ce(Je),onPresentInZoom:Ue(Je),context:{surface:A?"search":"browse"}})}):Qe?Ye.push({label:J._("Share link"),performAction:le(Je),disabled:je,className:"action-share-link",iconName:"link"}):Ye.push({label:J._("Share"),iconName:"link",performAction:ue(Je),disabled:je,className:"action-share"})}if(Ge.showCopyPublicFolderFileLink&&Ye.push({label:J._("Copy public link"),iconName:"link",className:"action-world-link",performAction:he(Je)}),Ge.showOpen&&Ye.push({label:J._("Open"),performAction:fe(Je),iconName:"open-in-app",className:"action-open-in-app"}),Ge.showShowInFolder&&Ye.push({label:J._("Show in folder"),performAction:ne(Je),iconName:"open-in-app",className:"action-show-in-folder"}),Ge.showDownload&&Ye.push({label:J._("Download"),performAction:_e({canShowUJPopup:P,args:Je}),disabled:ke,iconName:"download",className:"action-download"}),Ge.showOpenWith&&n&&Ye.push(function(){return s.default.createElement(h.ExtensionsMenu,{user:i,file:re,triggerType:b.TriggerType.SidebarLink,telemetryContext:{surface:"sidebar"}})}),Ge.showProfessionalCollectionShare){var Ze=J._("Add to showcase");Ye.push({label:Ze,iconName:"add-to-collection",performAction:de(Je,x),className:"action-add-to-collection",badge:void 0})}if(Ge.showComment&&Ye.push({label:J._("Add comment"),performAction:pe(Je),iconName:"add-comment",className:"action-add-comment"}),Ge.showStar?Ye.push({label:J._("Star",{comment:'Verb describing the "starring" action, not the noun.'}),ariaLabel:J._("Add to Starred"),ariaPressed:!1,performAction:we({isStarred:!0,args:Je}),iconName:"star",className:"action-star",key:"star"}):Ge.showUnstar&&Ye.push({label:J._("Unstar",{comment:'Verb describing the "unstarring" action.'}),ariaLabel:J._("Add to Starred"),ariaPressed:!0,performAction:we({isStarred:!1,args:Je}),iconName:"unstar",className:"action-unstar",key:"star"}),Ge.showVersions&&(void 0===Je.firstFile.is_versionable||Je.firstFile.is_versionable)&&Ye.push({label:J._("Version history"),performAction:Me(Je),iconName:"view-version-history",className:"action-view-version-history"}),Ge.showRewindFolder&&Ye.push({label:J._("Rewind",{project:"folder-history"}),performAction:be(Je),iconName:"revert-folder",className:"action-revert-folder"}),Ge.showRename&&Ye.push({label:J._("Rename"),performAction:me(Je),iconName:"rename",className:"action-rename",disabled:te}),Ge.showRenameTeamFolder&&Ye.push({label:J._("Rename"),performAction:Se(Je),iconName:"rename",className:"action-rename"}),Ge.showArchive&&Ye.push({label:J._("Archive"),performAction:ve(Je),iconName:"delete",className:"action-delete"}),Ge.showMove){var Ke=S&&!F?ge():Fe(Je,{showFolderSuggestion:H,createNewFolderInMoveDialog:j});Ye.push({label:J._("Move"),performAction:Ke,disabled:ae,iconName:"move",className:"action-move"})}if(Ge.showCopy){var Xe=S&&!F?ge():ye(Je,{showFolderSuggestion:H,createNewFolderInMoveDialog:j});Ye.push({label:J._("Copy"),performAction:Xe,disabled:ze,iconName:"copy",className:"action-copy"})}return Ge.showDelete&&Ye.push({label:J._("Delete"),performAction:Te(Je),disabled:se,iconName:"delete",className:"action-delete"}),Ge.showRestore&&Ye.push({label:J._("Restore"),className:"action-restore",performAction:Ae({args:Je}),disabled:Le}),Ge.showReadd&&Ye.push({label:J._("Re-add shared folder"),className:"action-re-add",performAction:Ee(Je),disabled:Le}),Ge.showPermanentDelete&&Ye.push({label:J._("Permanently delete"),iconName:"delete",className:"action-permanently-delete",performAction:Ne(Je)}),Ge.showSharedFolderEvents&&Ye.push({label:J._("Events"),performAction:Ce(Je),disabled:Ve,iconName:"events",className:"action-events"}),Ge.showCalculateFolderSize&&Ye.push({label:J._("Calculate size"),performAction:Pe(Je,{showFolderCalcSize:G}),disabled:qe,iconName:"calculate",className:"action-calculate-folder-size"}),Ge.showManageAsAdmin&&Ye.push({label:J._("View in admin console"),performAction:Re(Je),iconName:"settings-gear"}),Ge.showPin&&Ye.push({label:J._("Pin to %(path)s").format({path:l.Emstring.em_snippet(c.filename(r.currentFQPath),8,1)}),performAction:De(Je),iconName:"pin",disabled:He}),Ge.showPinTo&&Ye.push({label:J._("Pin to..."),performAction:Ie(Je),iconName:"pin",disabled:He}),Ge.showUnpin&&Ye.push({label:J._("Unpin"),performAction:Oe(Je),iconName:"pin",disabled:He}),Ye}var se=this;Object.defineProperty(o,"__esModule",{value:!0}),i=r.__importStar(i),s=r.__importDefault(s),t=r.__importStar(t),c=r.__importStar(c),f=r.__importStar(f),_=r.__importStar(_),p=r.__importStar(p),w=r.__importStar(w),F=r.__importStar(F),N=r.__importStar(N),D=r.__importStar(D),z=r.__importDefault(z),Y=r.__importStar(Y);var te={showProfessionalCollectionShare:!1,showTiburonShare:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showOpenWith:!1,showDownload:!1,showComment:!1,showDelete:!1,showArchive:!1,showRemove:!1,showRename:!1,showRenameTeamFolder:!1,showMove:!1,showCopy:!1,showVersions:!1,showRewindFolder:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showRemoveAccess:!1,showShowInFolder:!1,showStar:!1,showUnstar:!1,showLoadingStar:!1,showSharedFolderEvents:!1,showCalculateFolderSize:!1,showManageAsAdmin:!1,showPin:!1,showPinTo:!1,showUnpin:!1,showSplitShare:!1},ne=function(e){var o=e.user,r=e.files,i=e.firstFile,s=e.isSearchMode,t=e.source,a=e.viewType,l=r.map(function(e){return e.fq_path}).toArray();return function(){var e=l.map(function(e){return c.filename(e)}),u=c.parent_dir(l[0]),d=n.browse_uri_for_fq_path(o,u);e.length>1?d.updateQuery({select_multi:JSON.stringify(e)}):d.updateQuery({select:e[0]}),X({result:i,files:r,user:o,action_type:Q.WebUserActionLogEvent.SHOW_IN_FOLDER,view_type:a,isSearchMode:s,source:t}),window.open(d.toString(),"_blank")}},ae=function(e){return function(){re({autoShareLink:!1},e)}},le=function(e){return function(){re({autoShareLink:!0},e)}},ce=ae,ue=function(o){var i=ae(o);return function(){return r.__awaiter(se,void 0,void 0,function(){var s,t,n;return r.__generator(this,function(a){switch(a.label){case 0:return i(),o.isSidebar?[4,new Promise(function(o,r){e(["modules/clean/react/app_actions/telemetry_client"],o,r)}).then(r.__importStar)]:[2];case 1:return s=a.sent(),t=s.createTelemetryClient,n=s.getPiiSafeExtension,t({component:"share-btn"}).session({surface:o.isSearchMode?"search":"browse",ext:n(o.firstFile.ext)}).event("click_share",{trigger_type:b.TriggerType.SidebarPrimaryButton}),[2]}})})}},de=function(o,i,s,t){return function(){var t=o.user,n=o.files,a=o.firstFile,l=o.source,c=o.viewType,u=F.countFilesAndFolders(o.files),d=u.num_files_selected,h=u.num_folders_selected;if(w.logOpenAddToCollectionModal({uid:t.id,source:l,view_type:c,result:a,num_files_selected:d,num_folders_selected:h}),n.count()>=1){var f=n.map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path,fq_path:e.fq_path}}).toArray();new Promise(function(o,r){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],o,r)}).then(r.__importStar).then(function(e){(0,e.showAddToCollectionModal)(f,t,i,s)})}}},he=function(e){return function(){var o=e.user,r=e.context,i=e.firstFile;if(r.config&&i&&i.fq_path){var s=V.makePublicFolderLink(o.id,r.config,i.fq_path,i.is_dir);s&&V.showPublicFolderLinkModal(s)}}},fe=function(e){return function(){var o=e.user,r=e.firstFile,i=e.files,s=e.isSearchMode,t=e.source,n=e.viewType;X({result:r,files:i,user:o,action_type:Q.WebUserActionLogEvent.OPEN_DESKTOP,view_type:n,isSearchMode:s,source:t}),q.UnityFeatures.open_file(r.ns_id,r.ns_path,o.id,q.UnityFeatures.standard_open_file_handler,function(){return q.UnityFeatures.standard_open_file_handler(!1)})}},_e=function(e){var o=e.canShowUJPopup,r=e.args;return function(){var e=r.user,i=r.context,s=r.files,t=r.firstFile,n=r.isSearchMode,a=r.source,l=r.viewType,c=r.useSearchSuccessBanner;X({result:t,files:s,user:e,action_type:Q.WebUserActionLogEvent.DOWNLOAD,view_type:l,isSearchMode:n,source:a}),Le(c,n),m.browseActions.downloadFiles({files:s,context:i,user:e}),o&&S.maybeShowClientDownloadModal(!0)}},pe=function(e){return function(){var o=e.user,r=e.firstFile,i=e.files,s=e.isSearchMode,t=e.source,n=e.viewType,a=e.useSearchSuccessBanner;X({result:r,files:i,user:o,action_type:Q.WebUserActionLogEvent.ADD_COMMENT,view_type:n,isSearchMode:s,source:t}),xe(a,s),e.actionHandlers.onShowComment(r)}},we=function(e){var o=e.isStarred,r=e.args;return function(){var e=r.user,i=r.firstFile,s=r.files,t=r.isSearchMode,n=r.source,a=r.viewType,l=r.useSearchSuccessBanner;X({result:i,files:s,user:e,action_type:Q.WebUserActionLogEvent.STAR,view_type:a,isSearchMode:t,source:n}),Le(l,t),U.StarredActions.update(e.role,i.file_id,U.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,o)}},me=function(e){return function(){var o=e.user,r=e.actionHandlers,i=e.firstFile,s=e.files,t=e.isSearchMode,n=e.source,a=e.viewType,l=e.useSearchSuccessBanner;X({result:i,files:s,user:o,action_type:Q.WebUserActionLogEvent.RENAME,view_type:a,isSearchMode:t,source:n}),Le(l,t),r.onShowRename(i)}},Se=function(e){return function(){var o=e.user,r=e.files,i=e.firstFile,s=e.isSearchMode,t=e.source,n=e.viewType;X({result:i,files:r,user:o,action_type:Q.WebUserActionLogEvent.RENAME,view_type:n,isSearchMode:s,source:t}),f.showContentManagerBridge(r.toArray(),"rename",H.Viewer.get_viewer().team_is_limited)}},ve=function(e){return function(){var o=e.user,r=e.files,i=e.firstFile,s=e.isSearchMode,t=e.source,n=e.viewType;X({result:i,files:r,user:o,action_type:Q.WebUserActionLogEvent.ARCHIVE,view_type:n,isSearchMode:s,source:t}),f.showContentManagerBridge(r.toArray(),"archive",H.Viewer.get_viewer().team_is_limited)}},Fe=function(e,o){return function(){var s=e.user,t=e.context,n=e.files,a=e.firstFile,l=e.source,c=e.isSearchMode,u=e.viewType,h=e.useSearchSuccessBanner,f=n.toArray();X({result:a,files:n,user:s,action_type:Q.WebUserActionLogEvent.OPEN_MOVE_MODAL,view_type:u,isSearchMode:c,source:l}),Le(h,c);var p={user:s,files:f,path:c?void 0:t.currentFQPath,onSuccess:function(){var e=F.countFilesAndFolders(n),o=e.num_files_selected,r=e.num_folders_selected;w.logMoveFiles({uid:s.id,source:l,view_type:u,result:a,num_files_selected:o,num_folders_selected:r})},onRequestNotSent:function(){m.browseActions.selectFilesByFqPath({fqPathsToSelect:f.map(function(e){return e.fq_path})})},onUndo:function(){m.browseActions.selectRowsFromBoltClient(f)}};_.showMoveDialog({operation:R.Operation.MOVE,modalName:d.ModalName.MOVE,user:s,apiClient:{moveToFolder:function(e){var o=r.__assign({},p,{newPath:e,checkFSWs:!0});return N.moveFiles(o),Promise.resolve()},getFolderContents:P.getFolderContents,getFolderSuggestion:P.getFolderSuggestion},entries:f,initialFolderSelection:t.currentFQPath,onSuccess:i.noop,onCancel:i.noop,showFolderSuggestion:o.showFolderSuggestion,createNewFolderInMoveDialog:o.createNewFolderInMoveDialog})}},ye=function(e,o){return function(){var s=e.user,t=e.files,n=e.firstFile,a=e.isSearchMode,l=e.source,c=e.viewType,u=e.context,h=e.useSearchSuccessBanner,f=t.toArray();X({result:n,files:t,user:s,action_type:Q.WebUserActionLogEvent.OPEN_COPY_MODAL,view_type:c,isSearchMode:a,source:l}),Le(h,a);var p={user:s,files:f,onSuccess:function(e){var o=F.countFilesAndFolders(t),r=o.num_files_selected,i=o.num_folders_selected;w.logCopyFiles({uid:s.id,source:l,view_type:c,result:n,num_files_selected:r,num_folders_selected:i}),m.browseActions.selectRowsFromBoltClient(e)},onRequestNotSent:function(){m.browseActions.selectFilesByFqPath({fqPathsToSelect:f.map(function(e){return e.fq_path})})},onUndo:function(){m.browseActions.selectRowsFromBoltClient(f)}};_.showMoveDialog({operation:R.Operation.COPY,modalName:d.ModalName.COPY,user:s,entries:f,initialFolderSelection:u.currentFQPath,apiClient:{moveToFolder:function(e){var o=r.__assign({},p,{newPath:e,checkFSWs:!0});return N.copyFiles(o),Promise.resolve()},getFolderContents:P.getFolderContents,getFolderSuggestion:P.getFolderSuggestion},onSuccess:i.noop,onCancel:i.noop,showFolderSuggestion:o.showFolderSuggestion,createNewFolderInMoveDialog:o.createNewFolderInMoveDialog})}},ge=function(){return function(){p.showOverquota("wb_oq_mv_cp")}},Ae=function(e){var o=e.args;return function(){var e=o.actionHandlers,r=o.user,i=o.files,s=o.firstFile,t=o.isSearchMode,n=o.source,a=o.viewType,l=o.useSearchSuccessBanner,c=i.toArray();X({result:s,files:i,user:r,action_type:Q.WebUserActionLogEvent.RESTORE,view_type:a,isSearchMode:t,source:n}),Le(l,t),e.onRestore(c)}},be=function(e){return function(){var o=n.browse_uri_for_fq_path(e.user,e.firstFile.fq_path);o.setQuery({rewind:"true"}),Y.replace_location(o.toString())}},Ee=function(e){return function(){var o=e.user,r=e.context,i=e.firstFile,s=i.fq_path.toLowerCase(),t=r.inactiveNSIDByFQPath[s];t&&V.asyncMountSharedFolder(t,o.role,W.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,!1,null,!0)}},Me=function(e){return function(){var o=e.user,r=e.firstFile,i=e.files,s=e.isSearchMode,t=e.source,a=e.viewType,l=e.useSearchSuccessBanner;X({result:r,files:i,user:o,action_type:Q.WebUserActionLogEvent.VERSIONS,view_type:a,isSearchMode:s,source:t}),xe(l,s);var c=n.getFileHistoryUrl({fqPath:r.fq_path,userId:o.id});Y.redirect(c)}},Te=function(e){return function(){var o=e.user,r=e.actionHandlers,i=e.firstFile,s=e.files,t=e.isSearchMode,n=e.source,a=e.viewType,l=e.useSearchSuccessBanner;X({result:i,files:s,user:o,action_type:Q.WebUserActionLogEvent.DELETE,view_type:a,isSearchMode:t,source:n}),Le(l,t),r.onDelete(s.toArray())}},Ne=function(e){return function(){var o=e.user,r=e.actionHandlers,i=e.files,s=e.firstFile,t=e.isSearchMode,n=e.source,a=e.viewType,l=e.useSearchSuccessBanner;X({result:s,files:i,user:o,action_type:Q.WebUserActionLogEvent.PERMANENT_DELETE,view_type:a,isSearchMode:t,source:n}),Le(l,t),r.onPermanentDelete(i.toArray())}},Ce=function(e){return function(){var o=e.user,r=e.firstFile,i=e.files,s=e.isSearchMode,t=e.source,n=e.viewType;X({result:r,files:i,user:o,action_type:Q.WebUserActionLogEvent.EVENTS,view_type:n,isSearchMode:s,source:t}),Y.redirect("/events?ns="+r.target_ns)}},Pe=function(e,o){return function(){var r=e.user,i=e.firstFile,s=e.files,t=e.isSearchMode,n=e.source,a=e.viewType;X({result:i,files:s,user:r,action_type:Q.WebUserActionLogEvent.CALCULATE_SIZE,view_type:a,isSearchMode:t,source:n}),o.showFolderCalcSize?m.browseActions.fetchMultipleFolderSizes({files:s}):m.browseActions.fetchFolderSizes({file:i})}},Re=function(e){return function(){var o=e.user,r=e.context;V.asyncGoToContentManagerForPath({isLimitedTeam:H.Viewer.get_viewer().team_is_limited,containingFolder:r.currentFQPath,isCDM:o.is_cdm_member})}},De=function(e){return function(){var o=e.files,r=e.firstFile,i=e.user,s=e.viewType,t=e.source;I.getStoreForFolderOverview().dispatch(D.addContentReferencesForCurrentFolder({fileIds:o.toArray().map(L.fileToContentReferenceId)})),X({result:r,files:o,user:i,action_type:Q.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN,view_type:s,isSearchMode:!1,source:t})}},Ie=function(e){return function(){var o=e.files,r=e.firstFile,i=e.user,s=e.viewType,t=e.source,n=e.context,a=function(a){c.paths_are_equal(a,n.currentFQPath)?De(e)():(I.getStoreForFolderOverview().dispatch(D.addContentReferencesForPath({files:o.toArray(),path:a})),X({result:r,files:o,user:i,action_type:Q.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN,view_type:s,isSearchMode:!1,source:t}))};O.FolderOverviewPinToModal.show({user:i,path:n.currentFQPath,files:o.toArray(),onFolderSelected:a})}},Oe=function(e){return function(){var o=e.files,r=e.firstFile,i=e.user,s=e.viewType,t=e.source;I.getStoreForFolderOverview().dispatch(D.removeContentReferencesForCurrentFolder({fileIds:o.toArray().map(function(e){return e.file_id})})),X({result:r,files:o,user:i,action_type:Q.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN,view_type:s,isSearchMode:!1,source:t})}},Le=function(e,o){e&&o&&x.doSearchResultActionClickBroadcast(!0)},xe=function(e,o){e&&o&&x.setSearchSuccessBannerVisible()},Ue=function(e){return function(){T.asyncOpenPreview({containerId:v.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e.firstFile],indexOfPreviewFile:0,shouldFocusComment:!1,user:e.user,onFileViewerDidMount:T.hideElementsBehindFileViewer,onFileViewerUnmount:T.showElementsBehindFileViewer,fileViewAction:G.FileViewActionType.CLICK,fileViewOrigin:G.FileViewOriginType.BROWSE,fileViewTarget:G.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}};o.getActionsForFileCollection=ie});
//# sourceMappingURL=file_actions.min.js-vflj2BPO-.map