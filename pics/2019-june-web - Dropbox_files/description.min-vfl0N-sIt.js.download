define(["require","exports","tslib","external/classnames","react","draft-js","spectrum_comments/folder_overview_editor","spectrum/icon_action","spectrum/icon_admin","modules/clean/react/folder_overview/constants","modules/clean/react/folder_overview/placeholder","modules/clean/react/comments2/data/mentions_api","modules/core/browser","modules/core/exception"],function(e,t,n,o,r,a,i,s,d,l,c,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importDefault(r),p=n.__importStar(p);var m=(function(e){function t(t){var o=e.call(this,t)||this;return o.stateFromProps=function(e){try{return{updatesDisabled:!0,editorState:e.content?a.EditorState.createWithContent(a.convertFromRaw(e.content)):a.EditorState.createEmpty()}}catch(t){return h.reportException({err:t,tags:["folder-overview","browse"],severity:"user-error",exc_extra:{description:e.content}}),{updatesDisabled:!0,editorState:a.EditorState.createEmpty()}}},o.handleEditorStateChange=function(e){if(!o.props.isReadOnly){if(o.state.updatesDisabled)return void o.setState({updatesDisabled:!1});var t=!e.getCurrentContent().equals(o.state.editorState.getCurrentContent());o.setState({editorState:e}),t&&(o.props.content||""!==e.getCurrentContent().getPlainText().trim()?o.props.onDescriptionUpdated(a.convertToRaw(e.getCurrentContent())):o.props.onDescriptionUpdated())}},o.handleOpenLink=function(e){window.open(e)},o.handleMentionsQueryUpdated=function(e){o.mentionsApi&&(e.trim().length?o.mentionsApi.query(e,function(e){o.setState({mentionsQueryCache:o.fixNamesForMentionsQueryCache(e)})}):o.setState({mentionsQueryCache:o.fixNamesForMentionsQueryCache(o.mentionsApi.getMatchesWithStarterSuggestions())}))},o.fixNamesForMentionsQueryCache=function(e){var t={};return Object.keys(e).forEach(function(o){t[o]=e[o].map(function(e){return n.__assign({},e,{name:n.__assign({},e.name,{public:e.name.display||e.name.public})})})}),t},o.handleShare=function(e,t,n){var r=e.identifier;o.props.onShare(e,o.getNameFromMentionsCache(r),t,n)},o.getNameFromMentionsCache=function(e){for(var t=Object.keys(o.state.mentionsQueryCache),n=0,r=t;n<r.length;n++)for(var a=r[n],i=0,s=o.state.mentionsQueryCache[a];i<s.length;i++){var d=s[i];if(d.email===e)return d.name.display}return""},o.shouldShowPlaceholder=function(){var e=o.props.isReadOnly,t=o.state.editorState,n=t.getCurrentContent();return!e&&!n.hasText()&&"unstyled"===n.getFirstBlock().getType()&&!t.getSelection().getHasFocus()},o.renderPlaceholder=function(){return r.default.createElement("div",{onClick:o.focusEditor,onKeyDown:o.focusEditor,tabIndex:0,role:"button"},r.default.createElement(c.FolderOverviewPlaceholder,{folderExamplesLink:l.FOLDER_EXAMPLES_LINK_URI}))},o.setDraftRef=function(e){o.draftRef=e},o.focusEditor=function(){o.draftRef&&o.draftRef.focusEditor()},o.handleFolderExamplesButtonClick=function(e){e.stopPropagation(),p.open_tab(l.FOLDER_EXAMPLES_LINK_URI)},o.state=o.stateFromProps(t),t.isReadOnly||(o.mentionsApi=u.mentionsApi(t.user,!0)),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.onMount()},t.prototype.componentWillReceiveProps=function(e){e.descriptionKey===this.props.descriptionKey||this.state.editorState.getSelection().getHasFocus()||this.setState(this.stateFromProps(e)),this.mentionsApi||e.isReadOnly||(this.mentionsApi=u.mentionsApi(this.props.user))},Object.defineProperty(t.prototype,"features",{get:function(){switch(this.props.expFolderOverview){case"V1":return{inlineToolbar:!0};case"V2":return{inlineToolbar:!0,tasks:!0,mentions:!0};default:return{}}},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.isReadOnly,n=e.showReadOnlyIcon,a=e.author,c=e.hasUnsavedDraft,u=this.state.editorState,p=this.shouldShowPlaceholder();return r.default.createElement("div",{className:o.default({"folder-overview__description":!0,"folder-overview__placeholder":p})},t&&n?r.default.createElement(s.IconAction,{name:"permissions",className:"folder-overview__readonly-icon"}):c?r.default.createElement(d.IconAdmin,{name:"edit-group",className:"folder-overview__draft-icon"}):null,p&&this.renderPlaceholder(),r.default.createElement(i.FolderOverviewEditor,{author:a,features:this.features,localization:l.FOLDER_OVERVIEW_EDITOR_STRINGS,editorState:u,readOnly:t,onEditorStateChange:this.handleEditorStateChange,onOpenLink:this.handleOpenLink,onMentionsQueryUpdated:this.handleMentionsQueryUpdated,enableEmailMention:!0,mentionShareFlowHandlers:{onMention:this.props.onMention,onShare:this.handleShare},mentionsMatches:this.state.mentionsQueryCache,rootSharedFolderName:this.props.rootSharedFolderName,toolbarButtonOnboarding:this.handleFolderExamplesButtonClick,setDraftRef:this.setDraftRef}))},t})(r.default.PureComponent);t.FolderOverviewDescription=m});
//# sourceMappingURL=description.min.js-vflWXKT8v.map