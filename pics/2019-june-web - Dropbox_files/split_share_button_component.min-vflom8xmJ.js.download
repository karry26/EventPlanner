define(["require","exports","tslib","react","spectrum/button","modules/clean/react/extensions/file","modules/core/i18n","spectrum/popover","modules/clean/react/app_actions/telemetry_client","modules/clean/static_urls","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer/constants","modules/clean/react/css","modules/clean/react/extensions/data/types","external/classnames","modules/clean/react/app_actions/education/types","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/education/edu_tooltip_component","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/utils","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/action_creators","external/react-redux","modules/clean/filetypes","modules/clean/integrations/data/selectors"],function(e,t,n,o,r,i,s,a,l,p,c,u,h,d,_,g,S,f,m,v,I,y,T,x,E,O){"use strict";function A(e,t){var n=_.default({"extensions-popover-icon":e.type!==c.OpenButtonAction.INVITE_VIA_EMAIL,"extensions-invite-icon":e.type===c.OpenButtonAction.INVITE_VIA_EMAIL});return o.default.createElement(a.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},o.default.createElement("div",{className:"app-action-row-content"},o.default.createElement("img",{alt:"",src:p.static_url(t),className:n}),o.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),_=n.__importDefault(_);var P=(function(e){function t(t){var o=e.call(this,t)||this;return o.setActionMenuRef=function(e){o.actionMenuContent=e},o.handleClickShare=function(e){e.preventDefault(),o.props.onShowShare(),o.currentSession&&o.currentSession.event("click_share",{trigger_type:o.props.triggerType}),e.stopPropagation()},o.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),o.currentSession&&o.currentSession.event("select_action",{type:e.type,trigger_type:o.props.triggerType}),t.stopPropagation()},o.handlePreventMouseDown=function(e){e.preventDefault(),o.state.tooltipState===g.TooltipState.BIG_ONBOARDING_TOOLTIP&&(o.markSplitShareTooltipViewed(),o.setState({tooltipState:g.TooltipState.NO_TOOLTIP})),e.stopPropagation()},o.handlePopoverHover=function(){o.currentSession&&o.currentSession.event("popover_trigger_hover",{trigger_type:o.props.triggerType})},o.handleShareHover=function(){o.currentSession&&o.currentSession.event("share_hover",{trigger_type:o.props.triggerType})},o.handlePopoverToggle=function(e){var t=e.isOpen;o.props.onDropdownOpen&&o.props.onDropdownClose&&(t?o.props.onDropdownOpen():o.props.onDropdownClose()),o.currentSession&&o.currentSession.event(t?"open_popover":"close_popover",{trigger_type:o.props.triggerType})},o.handlePresentInZoom=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,s=n.onPresentInZoom,a=n.landingPageEnabled;i&&r&&s&&I.presentInZoomFlow(t,i,r,e,s,"split_share_button",a)},o.handleShareInSlack=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,s=n.landingPageEnabled;i&&r&&I.shareInSlackFlow(t,i,r,e,"split_share_button",s)},o.markSplitShareTooltipViewed=function(){S.markTooltipViewed(o.props.user.id,"split_share_edu")},o.state={tooltipState:g.TooltipState.NO_TOOLTIP},o.telemetryClient=l.createTelemetryClient(n.__assign({component:"split-share-btn"},t.context)),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},t.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,S.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=m.allowedTooltipsForConfig(this.props.extensionsConfig,i.getFileExt(this.props.file)||""),o=t.find(function(t){return void 0!==e[t]&&!e[t]}),"split_share_edu"===o&&this.setState({tooltipState:g.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}})})},t.prototype.getSplitShareOptions=function(e,t){var n=this,o=this.props,r=o.featureFlags,i=o.onPresentInZoom,a=o.refreshSharingServiceInfo,l=o.sharingServiceInfo,p=[];if(r.expSplitShareBtn&&"ON_SHOW_INVITE"===r.expSplitShareBtn&&p.push({handler:this.props.onShowShare,spriteName:null,text:s._("Invite via email"),type:c.OpenButtonAction.INVITE_VIA_EMAIL,userAction:u.UserAction.InviteViaEmail}),!l)return p;v.isSlackAvailable(l)&&p.push({handler:function(){return n.handleShareInSlack(e,t)},spriteName:null,text:s._("Share in Slack"),type:c.OpenButtonAction.SHARE_TO_SLACK,userAction:u.UserAction.ShareToSlack});var h=!(e.type!==E.FileTypes.FILE&&e.file_type!==E.FileTypes.FILE||e.is_cloud_doc||e.is_symlink);return v.isZoomAvailable(l)&&i&&a&&h&&p.push({handler:function(){return n.handlePresentInZoom(e,t)},spriteName:null,text:s._("Present in Zoom"),type:c.OpenButtonAction.PRESENT_IN_ZOOM,userAction:u.UserAction.PresentInZoom}),p},t.prototype.getButtonVariant=function(){var e=this.props,t=e.isVisible,n=e.variant;return n&&t?n:"invisible"},t.prototype.renderActions=function(){var e=this.props,t=e.user,n=e.file,r=[];return this.getSplitShareOptions(n,t).forEach(function(e){switch(e.type){case c.OpenButtonAction.INVITE_VIA_EMAIL:r.push(A(e,"/static/images/extensions/shared_small-vflTdrLa9.svg"));break;case c.OpenButtonAction.SHARE_TO_SLACK:r.push(A(e,"/static/images/thirdparty/slack_icon_circle-vfl4S6f-q.svg"));break;case c.OpenButtonAction.PRESENT_IN_ZOOM:r.push(A(e,"/static/images/thirdparty/zoom_icon_transparent_background-vflJC8HYC.svg"))}}),o.default.createElement(a.PopoverContent,{position:"below",attachment:"right"},r)},t.prototype.render=function(){var e=this.props,t=e.file,n=e.context,i=e.isVisible,p=e.shareButtonLabel,c=e.triggerType;n?this.currentSession=this.telemetryClient.session({ext:l.getPiiSafeExtension(t.ext)}):delete this.currentSession;var u=_.default({"primary-action-menu__button":c===d.TriggerType.SidebarPrimaryButton,"extensions-inline-share-button":!0});return o.default.createElement("div",{className:_.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!i}),ref:this.setActionMenuRef},o.default.createElement(r.Button,{"aria-label":p,className:u,onClick:this.handleClickShare,tabIndex:i?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handleShareHover},p),o.default.createElement(a.Popover,{className:"extensions-split-share__popover",onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,closeOnSelection:!0},o.default.createElement(a.PopoverTrigger,null,o.default.createElement(r.Button,{className:"extensions-split-share-menu__trigger",tagName:"span",tabIndex:i?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handlePopoverHover},"â–¾")),this.renderActions()),this.state.tooltipState===g.TooltipState.BIG_ONBOARDING_TOOLTIP?o.default.createElement(f.ExtensionsTooltip,{userId:this.props.user.id,targetNode:this.actionMenuContent,logHistory:this.markSplitShareTooltipViewed,title:s._("New ways to share"),message:s._("Now you can send files to Slack or present in Zoom without leaving Dropbox.")}):null)},t.defaultProps={isVisible:!0,shareButtonLabel:s._("Share"),triggerType:d.TriggerType.PrimaryButton,variant:"secondary"},t})(o.default.Component);t.SplitShareButtonComponent=P;var b=function(e,t){return{extensionsConfig:y.getConfigForFile(e,t.file.file_id),featureFlags:y.getFeatureFlags(e),sharingServiceInfo:y.getSharingServiceInfoAdapter(e),landingPageEnabled:O.isConnectServiceLandingPagesEnabled(e)}},N={refreshSharingServiceInfo:T.refreshSharingServiceInfoAdapter},w=x.connect(b,N)(P);t.SplitShareButton=h.requireCssWithComponent(w,["/static/css/extensions/index-vflIhvFue.css","/static/css/app-actions/index.css"])});
//# sourceMappingURL=split_share_button_component.min.js-vflAVgQNm.map